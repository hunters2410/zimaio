import{r as c,s as d,j as e,S as C,m as E}from"./index-DO0RgZ49.js";import{A}from"./AdminLayout-BKwUxqku.js";import{C as R}from"./clock-BObq69c6.js";import{E as K}from"./eye-DPlbvRrL.js";import{C as S}from"./circle-check-big-9UdHLz61.js";import{F as L}from"./file-text-CE8OtNx3.js";import{C as I}from"./circle-x-TK2e516B.js";import"./chevron-left-41R8eOj5.js";import"./x-DeAqnK16.js";import"./triangle-alert-BGFUz6oR.js";import"./chevron-right-Q63LQqcu.js";import"./zap-BYU6Jgn-.js";import"./maximize-Bk65GDgD.js";import"./store-66_jksTa.js";import"./users-BSjrVskw.js";import"./shield-DcS4_U9J.js";import"./globe-D32u69CK.js";import"./truck-B6XH1kda.js";import"./credit-card-CQ2BKawh.js";import"./settings-CrPpwdBJ.js";import"./trending-up-wwL8Hvm9.js";function ie(){var f,j;const[n,o]=c.useState([]),[V,l]=c.useState(!0),[r,x]=c.useState(null),[p,u]=c.useState(""),[m,Y]=c.useState("");c.useEffect(()=>{g()},[]);const g=async()=>{l(!0);const{data:t,error:a}=await d.from("vendor_profiles").select(`
        id,
        user_id,
        shop_name,
        kyc_status,
        kyc_details,
        created_at,
        profiles!vendor_profiles_user_id_fkey(email, full_name)
      `).neq("kyc_status","none").order("created_at",{ascending:!1});if(a)console.error("Error fetching KYC:",a),o([]);else{const i=(t||[]).map(s=>{var y,k,w,N,_,v;return{id:s.id,user_id:s.user_id,shop_name:s.shop_name,document_type:"Business Documents",document_number:((y=s.kyc_details)==null?void 0:y.id_number)||((k=s.kyc_details)==null?void 0:k.tax_number)||"N/A",document_url:((w=s.kyc_details)==null?void 0:w.document_url)||null,verification_status:s.kyc_status,submitted_at:((N=s.kyc_details)==null?void 0:N.submitted_at)||s.created_at,vendor_email:((_=s.profiles)==null?void 0:_.email)||"N/A",vendor_name:((v=s.profiles)==null?void 0:v.full_name)||s.shop_name,kyc_details:s.kyc_details}});o(i)}l(!1)},h=async t=>{l(!0);const a=n.find(s=>s.id===t),{error:i}=await d.from("vendor_profiles").update({kyc_status:"approved",is_verified:!0,is_approved:!0}).eq("id",t);i?alert("Error approving KYC: "+i.message):(a&&await d.from("notifications").insert({user_id:a.user_id,type:"success",title:"KYC Verification Approved",message:`Congratulations! Your business verification for "${a.shop_name}" has been approved. You can now start trading.`,is_read:!1}),g(),x(null)),l(!1)},D=async t=>{if(!p.trim()){alert("Please provide a rejection reason");return}l(!0);const a=n.find(s=>s.id===t),{error:i}=await d.from("vendor_profiles").update({kyc_status:"rejected",is_verified:!1,kyc_details:{...r==null?void 0:r.kyc_details,rejection_reason:p,rejected_at:new Date().toISOString()}}).eq("id",t);i?alert("Error rejecting KYC: "+i.message):(a&&await d.from("notifications").insert({user_id:a.user_id,type:"error",title:"KYC Verification Rejected",message:`Your business verification for "${a.shop_name}" was rejected. Reason: ${p}. Please update your details and resubmit.`,is_read:!1}),g(),x(null),u("")),l(!1)},b=n.filter(t=>t.vendor_name.toLowerCase().includes(m.toLowerCase())||t.vendor_email.toLowerCase().includes(m.toLowerCase())||t.shop_name.toLowerCase().includes(m.toLowerCase()));return V&&n.length===0?e.jsx(A,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})})}):e.jsxs(A,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-black text-gray-900 tracking-tight uppercase",children:"KYC Verification"}),e.jsx("p",{className:"text-sm font-bold text-gray-500 uppercase tracking-widest mt-1",children:"Audit and validate vendor documents"})]}),e.jsxs("div",{className:"relative w-full md:w-96",children:[e.jsx(C,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by vendor, email, or shop name...",className:"w-full pl-12 pr-4 py-3 bg-white border-2 border-gray-100 rounded-2xl focus:border-green-500 transition-all outline-none font-medium shadow-sm",value:m,onChange:t=>Y(t.target.value)})]})]}),e.jsx("div",{className:"bg-white rounded-2xl border-2 border-gray-100 overflow-hidden shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50/80 border-b-2 border-gray-100",children:[e.jsx("th",{className:"px-6 py-4 text-[11px] font-black text-gray-400 uppercase tracking-widest",children:"Vendor Details"}),e.jsx("th",{className:"px-6 py-4 text-[11px] font-black text-gray-400 uppercase tracking-widest",children:"Shop & ID"}),e.jsx("th",{className:"px-6 py-4 text-[11px] font-black text-gray-400 uppercase tracking-widest",children:"Submitted At"}),e.jsx("th",{className:"px-6 py-4 text-[11px] font-black text-gray-400 uppercase tracking-widest",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-[11px] font-black text-gray-400 uppercase tracking-widest text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y-2 divide-gray-50",children:b.length>0?b.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50/50 transition-colors group",children:[e.jsx("td",{className:"px-6 py-5",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-black text-gray-900 uppercase tracking-tight",children:t.vendor_name}),e.jsx("span",{className:"text-xs font-bold text-gray-400",children:t.vendor_email})]})}),e.jsx("td",{className:"px-6 py-5",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-black text-green-700 uppercase tracking-tighter",children:t.shop_name}),e.jsxs("span",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider mt-0.5",children:["ID: ",t.document_number]})]})}),e.jsx("td",{className:"px-6 py-5",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(R,{size:14,className:"text-gray-400"}),e.jsx("span",{className:"text-xs font-bold",children:new Date(t.submitted_at).toLocaleString()})]})}),e.jsx("td",{className:"px-6 py-5",children:e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest border ${t.verification_status==="pending"?"bg-yellow-50 text-yellow-700 border-yellow-100":t.verification_status==="approved"?"bg-green-50 text-green-700 border-green-100":"bg-red-50 text-red-700 border-red-100"}`,children:[e.jsx("div",{className:`w-1 h-1 rounded-full mr-1.5 ${t.verification_status==="pending"?"bg-yellow-500":t.verification_status==="approved"?"bg-green-500":"bg-red-500"}`}),t.verification_status]})}),e.jsx("td",{className:"px-6 py-5 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs("button",{onClick:()=>x(t),className:"flex items-center px-4 py-2 text-[10px] font-black uppercase tracking-widest text-blue-600 bg-blue-50 border border-blue-100 rounded-xl hover:bg-blue-600 hover:text-white transition-all shadow-sm",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Auditing"]}),t.verification_status==="pending"&&e.jsxs("button",{onClick:()=>h(t.id),className:"flex items-center px-4 py-2 text-[10px] font-black uppercase tracking-widest text-green-600 bg-green-50 border border-green-100 rounded-xl hover:bg-green-600 hover:text-white transition-all shadow-sm",children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Verify"]})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-gray-300",children:[e.jsx(C,{size:48,className:"mb-3 opacity-20"}),e.jsx("p",{className:"text-xs font-black uppercase tracking-[0.2em]",children:"No Matches Found"})]})})})})]})})}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-in fade-in duration-300",children:e.jsxs("div",{className:"bg-white rounded-3xl p-8 max-w-2xl w-full shadow-2xl border border-white/20",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsx("div",{className:"w-12 h-12 bg-green-50 rounded-2xl flex items-center justify-center text-green-600 border border-green-100",children:e.jsx(z,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-black text-gray-900 uppercase tracking-tighter",children:"Business Audit"}),e.jsxs("p",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-widest",children:["Verifying Information for ",r.shop_name]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-8 mb-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1.5",children:"Legal Representative"}),e.jsx("p",{className:"text-sm font-black text-gray-900",children:r.vendor_name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1.5",children:"Identification Type"}),e.jsx("p",{className:"text-sm font-black text-gray-900 uppercase",children:r.document_type.replace(/_/g," ")})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1.5",children:"Transmission Date"}),e.jsx("p",{className:"text-sm font-black text-gray-900",children:new Date(r.submitted_at).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1.5",children:"Identification Number"}),e.jsx("p",{className:"text-sm font-black text-gray-900",children:r.document_number})]})]})]}),e.jsxs("div",{className:"mb-8 p-6 bg-gray-50/50 rounded-2xl border-2 border-gray-100",children:[e.jsx("label",{className:"block text-[10px] font-black text-gray-400 uppercase tracking-widest mb-4",children:"Verification Artifacts"}),((j=(f=r.kyc_details)==null?void 0:f.documents)==null?void 0:j.length)>0?e.jsx("div",{className:"grid grid-cols-1 gap-3",children:r.kyc_details.documents.map((t,a)=>e.jsxs("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-between p-4 bg-white border border-gray-100 rounded-2xl hover:border-green-500 transition-all group shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-green-50 text-green-600 rounded-xl group-hover:bg-green-600 group-hover:text-white transition-colors",children:e.jsx(L,{size:18})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-xs font-black text-gray-900 truncate max-w-[250px] uppercase tracking-tighter",children:t.name}),e.jsxs("p",{className:"text-[9px] text-gray-400 font-bold",children:[(t.size/1024).toFixed(1)," KB â€¢ Path: ",t.path||"N/A"]})]})]}),e.jsx("span",{className:"text-[10px] font-black text-green-600 uppercase tracking-widest bg-green-50 px-4 py-2 rounded-xl border border-green-100",children:"Auditing Asset"})]},a))}):r.document_url?e.jsxs("a",{href:r.document_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-4 p-4 bg-white border border-gray-100 rounded-2xl text-blue-600 hover:border-blue-500 transition-all shadow-sm",children:[e.jsx(L,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-black uppercase tracking-widest",children:"Verify Primary Transmission"})]}):e.jsxs("div",{className:"text-center py-6 text-gray-400",children:[e.jsx(E,{size:24,className:"mx-auto mb-2 opacity-20"}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest",children:"No Artifacts Found"})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("label",{className:"block text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1.5",children:"Compliance Commentary"}),e.jsx("textarea",{value:p,onChange:t=>u(t.target.value),rows:3,className:"w-full px-5 py-4 bg-gray-50/50 border-2 border-gray-100 rounded-2xl focus:border-red-500 transition-all outline-none text-sm font-medium placeholder:text-gray-300",placeholder:"Declare reason if rejecting application..."})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 pt-4 border-t-2 border-gray-50",children:[e.jsx("button",{onClick:()=>{x(null),u("")},className:"order-3 sm:order-1 px-8 py-4 border-2 border-gray-100 rounded-2xl text-[11px] font-black uppercase tracking-widest hover:bg-gray-50 transition-all",children:"Cancel Audit"}),e.jsxs("button",{onClick:()=>D(r.id),className:"order-2 px-8 py-4 bg-red-50 text-red-600 border-2 border-red-100 rounded-2xl text-[11px] font-black uppercase tracking-widest hover:bg-red-600 hover:text-white transition-all shadow-lg shadow-red-500/10 flex items-center justify-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),"Reject"]}),e.jsxs("button",{onClick:()=>h(r.id),className:"order-1 px-8 py-4 bg-green-600 text-white rounded-2xl text-[11px] font-black uppercase tracking-widest hover:bg-black transition-all shadow-lg shadow-green-500/20 flex items-center justify-center gap-2 active:scale-95",children:[e.jsx(S,{className:"h-4 w-4"}),"Approve Entity"]})]})]})})]})}const z=({className:n,size:o})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:o||24,height:o||24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:e.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"})});export{ie as KYCVerification};
