import{q as P,u as R,y as A,r as x,s as f,j as e,w as E}from"./index-T9wcIP7k.js";import{A as D}from"./AdminLayout-CfMOCoMf.js";import{A as q}from"./arrow-left-CeWPuxjJ.js";import{S as N}from"./shield-BnwYx_xt.js";import{S as T}from"./save-Bbxo6HuH.js";import{P as F}from"./plus-B2DFtXvD.js";import{C as V}from"./check-CtKt80mY.js";import{S as B}from"./square-pen-ryj9D0Al.js";import{T as L}from"./trash-2-RCUSiwrv.js";import"./bell-B6qorZ8L.js";import"./triangle-alert-C6svA3ly.js";import"./circle-check-big-BYTb-izI.js";import"./chevron-right-DQGX3U4F.js";import"./settings-CBK8R_-F.js";import"./zap-_oUAMe_n.js";import"./maximize-CxfeF--5.js";import"./users-CYjWSRo-.js";import"./file-text-D26nKDmr.js";import"./globe-BkMXYPOg.js";import"./truck-CI4bnO7s.js";import"./credit-card-DbXuWlg0.js";import"./trending-up-D57PSrGr.js";const w=[{key:"customers",label:"Customer Management",description:"Manage customer accounts and data"},{key:"vendors",label:"Vendor Management",description:"Manage vendor accounts and shops"},{key:"products",label:"Product Management",description:"Manage product catalog"},{key:"orders",label:"Order Management",description:"Process and manage orders"},{key:"financial",label:"Financial Management",description:"Wallet, transactions, commissions"},{key:"analytics",label:"Analytics & Reports",description:"View analytics and reports"},{key:"settings",label:"System Settings",description:"Configure system settings"},{key:"support",label:"Support Tickets",description:"Manage customer support"},{key:"delivery",label:"Delivery Management",description:"Manage deliveries and drivers"},{key:"kyc",label:"KYC Verification",description:"Verify vendor documents"},{key:"roles",label:"Roles & Permissions",description:"Manage roles and permissions"},{key:"refunds",label:"Refund Management",description:"Process refund requests"},{key:"coupons",label:"Coupon Management",description:"Create and manage coupons"},{key:"reviews",label:"Review Management",description:"Moderate product reviews"},{key:"notifications",label:"Notifications",description:"Send and manage notifications"}],O=[{key:"create",label:"Create",icon:F,color:"text-green-600"},{key:"read",label:"View",icon:V,color:"text-blue-600"},{key:"update",label:"Edit",icon:B,color:"text-yellow-600"},{key:"delete",label:"Delete",icon:L,color:"text-red-600"}];function de(){const{id:d}=P(),y=R(),{theme:_}=A(),n=_==="dark",l=!!d,[k,p]=x.useState(!1),[u,g]=x.useState(null),b=()=>{const s={};return w.forEach(r=>{s[r.key]={create:!1,read:!1,update:!1,delete:!1}}),s},[t,c]=x.useState({role_name:"",role_description:"",permissions:b(),is_active:!0});x.useEffect(()=>{l&&C()},[d]);const C=async()=>{if(d){p(!0);try{const{data:s,error:r}=await f.from("user_roles").select("*").eq("id",d).single();if(r)throw r;if(s){const a=s.permissions||b(),i=b();Object.keys(i).forEach(h=>{a[h]&&(i[h]=a[h])}),c({role_name:s.role_name,role_description:s.role_description||"",permissions:i,is_active:s.is_active})}}catch(s){g({type:"error",text:s.message})}finally{p(!1)}}},S=async s=>{s.preventDefault(),p(!0);try{if(l){const{error:r}=await f.from("user_roles").update({role_name:t.role_name,role_description:t.role_description,permissions:t.permissions,is_active:t.is_active}).eq("id",d);if(r)throw r;g({type:"success",text:"Role updated successfully"})}else{const{error:r}=await f.from("user_roles").insert({role_name:t.role_name,role_description:t.role_description,permissions:t.permissions,is_active:t.is_active});if(r)throw r;g({type:"success",text:"Role created successfully"})}setTimeout(()=>{y("/admin/roles-permissions")},1500)}catch(r){g({type:"error",text:r.message||`Failed to ${l?"update":"create"} role`})}finally{p(!1)}},$=(s,r)=>{c(a=>{var i;return{...a,permissions:{...a.permissions,[s]:{...a.permissions[s]||{},[r]:!((i=a.permissions[s])!=null&&i[r])}}}})},j=(s,r)=>{c(a=>({...a,permissions:{...a.permissions,[s]:{create:r,read:r,update:r,delete:r}}}))},M=n?"bg-gray-800":"bg-white",o=n?"text-gray-100":"text-gray-900",v=n?"text-gray-400":"text-gray-600",m=n?"border-gray-700":"border-gray-200";return e.jsxs(D,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>y("/admin/roles-permissions"),className:"flex items-center gap-2 text-cyan-600 hover:text-cyan-700 mb-4",children:[e.jsx(q,{className:"h-4 w-4"}),"Back to Roles & Permissions"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N,{className:"h-8 w-8 text-cyan-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:`text-3xl font-bold ${o}`,children:l?"Edit Role":"Create New Role"}),e.jsx("p",{className:v,children:l?"Update role details and permissions":"Define a new role with specific permissions"})]})]})]}),u&&e.jsxs("div",{className:`mb-6 p-4 rounded-lg flex items-start space-x-3 ${u.type==="success"?"bg-green-50 border border-green-200 text-green-800":"bg-red-50 border border-red-200 text-red-800"}`,children:[e.jsx(E,{className:"h-5 w-5 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:u.text})]}),e.jsxs("form",{onSubmit:S,className:`${M} rounded-lg shadow-sm p-6`,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${o} mb-2`,children:"Role Name *"}),e.jsx("input",{type:"text",required:!0,value:t.role_name,onChange:s=>c({...t,role_name:s.target.value}),className:`w-full px-4 py-2 border ${m} rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 ${n?"bg-gray-700 text-gray-100":"bg-white"}`,placeholder:"e.g., Manager, Supervisor"})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${o} mb-2`,children:"Description *"}),e.jsx("input",{type:"text",required:!0,value:t.role_description,onChange:s=>c({...t,role_description:s.target.value}),className:`w-full px-4 py-2 border ${m} rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 ${n?"bg-gray-700 text-gray-100":"bg-white"}`,placeholder:"Brief description of this role"})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.is_active,onChange:s=>c({...t,is_active:s.target.checked}),className:"rounded text-cyan-600 focus:ring-cyan-500"}),e.jsx("span",{className:`text-sm ${o}`,children:"Active Role"})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:`text-xl font-semibold ${o} mb-4 flex items-center gap-2`,children:[e.jsx(N,{className:"h-5 w-5 text-cyan-600"}),"Permissions"]}),e.jsx("div",{className:"space-y-4",children:w.map(s=>e.jsxs("div",{className:`p-4 border ${m} rounded-lg`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:`font-semibold ${o}`,children:s.label}),e.jsx("p",{className:`text-sm ${v}`,children:s.description})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>j(s.key,!0),className:"text-xs px-3 py-1 bg-green-50 text-green-700 rounded hover:bg-green-100 transition",children:"Select All"}),e.jsx("button",{type:"button",onClick:()=>j(s.key,!1),className:"text-xs px-3 py-1 bg-red-50 text-red-700 rounded hover:bg-red-100 transition",children:"Clear All"})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:O.map(r=>{var a,i;return e.jsxs("label",{className:`flex items-center space-x-2 cursor-pointer p-3 rounded-lg border transition ${(a=t.permissions[s.key])!=null&&a[r.key]?"bg-cyan-50 dark:bg-cyan-900/20 border-cyan-300 dark:border-cyan-700":`${m} hover:bg-gray-50 dark:hover:bg-gray-700`}`,children:[e.jsx("input",{type:"checkbox",checked:((i=t.permissions[s.key])==null?void 0:i[r.key])||!1,onChange:()=>$(s.key,r.key),className:"rounded text-cyan-600 focus:ring-cyan-500"}),e.jsx(r.icon,{className:`h-4 w-4 ${r.color}`}),e.jsx("span",{className:`text-sm font-medium ${o}`,children:r.label})]},r.key)})})]},s.key))})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:()=>y("/admin/roles-permissions"),className:`px-6 py-2 border ${m} rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition`,children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:k,className:"flex items-center gap-2 px-6 py-2 bg-gradient-to-r from-cyan-600 to-green-600 text-white rounded-lg hover:from-cyan-700 hover:to-green-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(T,{className:"h-5 w-5"}),k?"Processing...":l?"Update Role":"Create Role"]})]})]})]})}export{de as RoleForm};
