import{e as R,r as n,s as b,j as e,w as q,X as w,D as y,l as N}from"./index-T9wcIP7k.js";import{W as A}from"./wallet-C7uK7jSh.js";import{T as M}from"./trending-up-D57PSrGr.js";import{T as E}from"./trending-down-BkJW1vDt.js";import{C as U}from"./clock-Hzc8pPp_.js";import{C as v}from"./check-CtKt80mY.js";import{C as I}from"./circle-x-COGKxlZd.js";function L(){const{user:r}=R(),[l,_]=n.useState(null),[g,W]=n.useState([]),[m,c]=n.useState(!0),[C,d]=n.useState(!1),[x,o]=n.useState(null),[a,i]=n.useState({amount:"",currency:"USD",payment_method:"",account_details:""});n.useEffect(()=>{r&&(S(),p())},[r]);const S=async()=>{c(!0);try{const{data:s,error:t}=await b.from("wallets").select("*").eq("user_id",r==null?void 0:r.id).single();if(t)throw t;_({id:s.id,balance_usd:Number(s.balance_usd)||0,balance_zig:Number(s.balance_zig)||0,total_earned:Number(s.total_earned)||0,total_commission_earned:Number(s.total_commission_earned)||0,total_withdrawn:Number(s.total_withdrawn)||0})}catch(s){o({type:"error",text:s.message})}finally{c(!1)}},p=async()=>{try{const{data:s,error:t}=await b.from("withdrawal_requests").select("*").eq("vendor_id",r==null?void 0:r.id).order("requested_at",{ascending:!1});if(t)throw t;W(s||[])}catch(s){console.error("Error fetching withdrawal requests:",s)}},h=s=>(s*.02).toFixed(2),F=async s=>{if(s.preventDefault(),!!l){c(!0);try{const t=parseFloat(a.amount),u=a.currency==="USD"?l.balance_usd:l.balance_zig;if(t>u)throw new Error("Insufficient balance");if(t<10)throw new Error("Minimum withdrawal amount is 10");const j=parseFloat(h(t)),D=t-j,{error:f}=await b.from("withdrawal_requests").insert([{vendor_id:r==null?void 0:r.id,amount:t,currency:a.currency,withdrawal_charges:j,net_amount:D,payment_method:a.payment_method,account_details:{details:a.account_details},status:"pending"}]);if(f)throw f;o({type:"success",text:"Withdrawal request submitted successfully. Awaiting admin approval."}),d(!1),i({amount:"",currency:"USD",payment_method:"",account_details:""}),p()}catch(t){o({type:"error",text:t.message})}finally{c(!1)}}},k=s=>{const t={pending:"bg-yellow-100 text-yellow-800",approved:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"},u={pending:e.jsx(U,{className:"h-4 w-4"}),approved:e.jsx(v,{className:"h-4 w-4"}),completed:e.jsx(v,{className:"h-4 w-4"}),rejected:e.jsx(I,{className:"h-4 w-4"})};return e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 text-xs font-semibold rounded-full ${t[s]}`,children:[u[s],s.charAt(0).toUpperCase()+s.slice(1)]})};return m&&!l?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-600"})}):l?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b",children:e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(A,{className:"h-8 w-8 text-cyan-600"}),"My Wallet"]}),e.jsx("p",{className:"text-gray-600",children:"Manage your earnings and withdrawals"})]})}),e.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-6",children:[x&&e.jsxs("div",{className:`p-4 rounded-lg flex items-start space-x-3 ${x.type==="success"?"bg-green-50 border border-green-200 text-green-800":"bg-red-50 border border-red-200 text-red-800"}`,children:[e.jsx(q,{className:"h-5 w-5 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:x.text}),e.jsx("button",{onClick:()=>o(null),className:"ml-auto",children:e.jsx(w,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-cyan-500 to-cyan-600 rounded-lg shadow-sm p-6 text-white",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(y,{className:"h-8 w-8"})}),e.jsxs("div",{className:"text-3xl font-bold mb-1",children:["$",l.balance_usd.toFixed(2)]}),e.jsx("p",{className:"text-cyan-100",children:"USD Balance"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-500 to-green-600 rounded-lg shadow-sm p-6 text-white",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(y,{className:"h-8 w-8"})}),e.jsxs("div",{className:"text-3xl font-bold mb-1",children:[l.balance_zig.toFixed(2)," ZIG"]}),e.jsx("p",{className:"text-green-100",children:"ZIG Balance"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg shadow-sm p-6 text-white",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(M,{className:"h-8 w-8"})}),e.jsxs("div",{className:"text-3xl font-bold mb-1",children:["$",l.total_commission_earned.toFixed(2)]}),e.jsx("p",{className:"text-blue-100",children:"Commission Earned"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg shadow-sm p-6 text-white",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(E,{className:"h-8 w-8"})}),e.jsxs("div",{className:"text-3xl font-bold mb-1",children:["$",l.total_withdrawn.toFixed(2)]}),e.jsx("p",{className:"text-purple-100",children:"Total Withdrawn"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Request Withdrawal"}),e.jsxs("button",{onClick:()=>d(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-cyan-600 to-green-600 text-white rounded-lg hover:from-cyan-700 hover:to-green-700 transition",children:[e.jsx(N,{className:"h-5 w-5"}),"Withdraw Funds"]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"Withdrawal Information"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"• Minimum withdrawal amount: $10 or 10 ZIG"}),e.jsx("li",{children:"• Withdrawal charges: 2% of the withdrawal amount"}),e.jsx("li",{children:"• Processing time: 1-3 business days after admin approval"}),e.jsx("li",{children:"• All withdrawals require admin approval"})]})]}),e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Recent Withdrawal Requests"}),g.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No withdrawal requests yet"}):e.jsx("div",{className:"space-y-4",children:g.map(s=>e.jsx("div",{className:"p-4 border border-gray-200 rounded-lg hover:shadow-md transition",children:e.jsx("div",{className:"flex items-start justify-between mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("span",{className:"text-xl font-bold text-gray-900",children:[s.amount," ",s.currency]}),k(s.status)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Withdrawal Charges:"})," ",e.jsxs("span",{className:"text-red-600",children:[s.withdrawal_charges," ",s.currency]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Net Amount:"})," ",e.jsxs("span",{className:"text-green-600 font-semibold",children:[s.net_amount," ",s.currency]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Requested:"})," ",new Date(s.requested_at).toLocaleString()]}),s.processed_at&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Processed:"})," ",new Date(s.processed_at).toLocaleString()]})]}),s.rejection_reason&&e.jsxs("div",{className:"mt-2 p-2 bg-red-50 border border-red-200 rounded text-sm text-red-800",children:[e.jsx("span",{className:"font-medium",children:"Rejection Reason:"})," ",s.rejection_reason]})]})})},s.id))})]}),C&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Request Withdrawal"}),e.jsx("button",{onClick:()=>d(!1),className:"text-gray-500 hover:text-gray-600 transition",children:e.jsx(w,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900 mb-2",children:"Currency *"}),e.jsxs("select",{required:!0,value:a.currency,onChange:s=>i({...a,currency:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 bg-white",children:[e.jsxs("option",{value:"USD",children:["USD (Available: $",l.balance_usd.toFixed(2),")"]}),e.jsxs("option",{value:"ZIG",children:["ZIG (Available: ",l.balance_zig.toFixed(2),")"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900 mb-2",children:"Amount *"}),e.jsx("input",{type:"number",required:!0,step:"0.01",min:"10",value:a.amount,onChange:s=>i({...a,amount:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500",placeholder:"Minimum 10"}),a.amount&&e.jsxs("div",{className:"mt-2 text-sm space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Withdrawal Amount:"}),e.jsxs("span",{className:"font-medium",children:[a.amount," ",a.currency]})]}),e.jsxs("div",{className:"flex justify-between text-red-600",children:[e.jsx("span",{children:"Charges (2%):"}),e.jsxs("span",{className:"font-medium",children:[h(parseFloat(a.amount))," ",a.currency]})]}),e.jsxs("div",{className:"flex justify-between text-green-600 font-semibold border-t pt-1",children:[e.jsx("span",{children:"You will receive:"}),e.jsxs("span",{children:[(parseFloat(a.amount)-parseFloat(h(parseFloat(a.amount)))).toFixed(2)," ",a.currency]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900 mb-2",children:"Payment Method *"}),e.jsxs("select",{required:!0,value:a.payment_method,onChange:s=>i({...a,payment_method:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 bg-white",children:[e.jsx("option",{value:"",children:"Select payment method"}),e.jsx("option",{value:"bank_transfer",children:"Bank Transfer"}),e.jsx("option",{value:"mobile_money",children:"Mobile Money"}),e.jsx("option",{value:"paypal",children:"PayPal"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900 mb-2",children:"Account Details *"}),e.jsx("textarea",{required:!0,value:a.account_details,onChange:s=>i({...a,account_details:s.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500",placeholder:"Enter your account details (account number, mobile number, email, etc.)"})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"Your withdrawal request will be reviewed by an admin. You will be notified once it's processed."})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>d(!1),className:"px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 transition",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:m,className:"flex items-center gap-2 px-6 py-2 bg-gradient-to-r from-cyan-600 to-green-600 text-white rounded-lg hover:from-cyan-700 hover:to-green-700 transition disabled:opacity-50",children:[e.jsx(N,{className:"h-5 w-5"}),m?"Processing...":"Submit Request"]})]})]})]})})]})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-600",children:"Wallet not found"})})}export{L as VendorWallet};
