import{g as C,u as P,e as F,r as n,s as i,j as e,c as $,w as E}from"./index-T9wcIP7k.js";import{L as j,S as A}from"./smartphone-ChSB_H3g.js";import{C as D}from"./circle-check-B7qSo7SU.js";import{Z as G}from"./zap-_oUAMe_n.js";import{C as I}from"./credit-card-DbXuWlg0.js";import{G as T}from"./globe-BkMXYPOg.js";import{B as z}from"./banknote-COCCxm_1.js";import{C as L}from"./chevron-right-DQGX3U4F.js";function U(){const[x]=C(),p=P(),{profile:c}=F(),l=x.get("packageId"),o=x.get("plan"),[N,u]=n.useState(!0),[h,g]=n.useState(!1),[d,w]=n.useState([]),[a,b]=n.useState(null),[r,v]=n.useState(null),[k,f]=n.useState("idle");n.useEffect(()=>{if(!l){p("/vendor/dashboard?tab=packages");return}_()},[l]);const _=async()=>{u(!0);try{const{data:s}=await i.from("vendor_packages").select("*").eq("id",l).single();v(s);const{data:t}=await i.from("payment_gateways").select("*").eq("is_active",!0).order("sort_order",{ascending:!0});w(t||[]),t!=null&&t.length&&b(t[0].id)}catch(s){console.error("Error fetching payment data:",s)}finally{u(!1)}},S=async()=>{var s;if(!(!a||!l||!c)){g(!0);try{await new Promise(m=>setTimeout(m,2e3));const{error:t}=await i.from("vendor_subscriptions").upsert({vendor_id:c.id,package_id:l,status:"active",billing_cycle:"monthly",last_payment_date:new Date().toISOString(),next_billing_date:new Date(new Date().setMonth(new Date().getMonth()+1)).toISOString()},{onConflict:"vendor_id"});if(t)throw t;const{error:y}=await i.from("payment_transactions").insert({user_id:c.id,amount:r.price_monthly,currency:"USD",status:"completed",gateway_id:a,gateway_type:(s=d.find(m=>m.id===a))==null?void 0:s.gateway_type,metadata:{package_id:l,plan_name:o}});if(y)throw y;f("success"),setTimeout(()=>{p("/vendor/dashboard?tab=packages")},3e3)}catch(t){console.error("Payment error:",t),f("error")}finally{g(!1)}}};return N?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(j,{className:"w-12 h-12 text-purple-600 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-bold uppercase tracking-widest text-xs",children:"Securing session..."})]})}):k==="success"?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-[3rem] p-12 text-center shadow-2xl border border-green-100 animate-in zoom-in-95 duration-500",children:[e.jsx("div",{className:"w-24 h-24 bg-green-50 rounded-full flex items-center justify-center mx-auto mb-8",children:e.jsx(D,{className:"w-12 h-12 text-green-500"})}),e.jsx("h2",{className:"text-4xl font-black text-gray-900 mb-4 tracking-tighter uppercase",children:"Payment Verified!"}),e.jsxs("p",{className:"text-gray-500 mb-8 font-medium",children:["Your subscription to ",e.jsx("span",{className:"text-purple-600 font-black",children:o})," is now active. Redirecting you to your dashboard..."]}),e.jsx("div",{className:"w-full bg-gray-100 h-1 rounded-full overflow-hidden",children:e.jsx("div",{className:"bg-green-500 h-full animate-progress"})})]})}):e.jsx("div",{className:"min-h-screen bg-[#F8FAFC] py-12 px-4",children:e.jsxs("div",{className:"max-w-5xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-12",children:[e.jsx("div",{className:"lg:col-span-5 space-y-8 order-2 lg:order-1",children:e.jsxs("div",{className:"bg-white rounded-[2.5rem] p-10 shadow-xl border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx("div",{className:"p-3 bg-purple-50 rounded-2xl",children:e.jsx(G,{className:"w-6 h-6 text-purple-600"})}),e.jsx("h3",{className:"text-xl font-black text-gray-900 uppercase tracking-tight",children:"Order Summary"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center pb-6 border-b border-gray-100",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black text-gray-400 uppercase tracking-[0.2em] mb-1",children:"Selected Plan"}),e.jsx("p",{className:"text-xl font-black text-gray-900",children:o})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[10px] font-black text-gray-400 uppercase tracking-[0.2em] mb-1",children:"Duration"}),e.jsx("p",{className:"text-sm font-bold text-gray-600",children:"Monthly"})]})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm font-bold text-gray-500",children:[e.jsx("span",{children:"Subscription Fee"}),e.jsxs("span",{className:"tabular-nums",children:["$",r==null?void 0:r.price_monthly]})]}),e.jsxs("div",{className:"flex justify-between text-sm font-bold text-gray-500",children:[e.jsx("span",{children:"Admin Fees"}),e.jsx("span",{className:"tabular-nums",children:"$0.00"})]}),e.jsxs("div",{className:"flex justify-between items-center pt-6 border-t border-gray-100",children:[e.jsx("span",{className:"text-lg font-black text-gray-900 uppercase",children:"Total Amount"}),e.jsxs("span",{className:"text-3xl font-black text-purple-600 tabular-nums",children:["$",r==null?void 0:r.price_monthly]})]})]})]}),e.jsxs("div",{className:"mt-12 p-6 bg-blue-50/50 rounded-3xl border border-blue-100 flex gap-4",children:[e.jsx($,{className:"w-8 h-8 text-blue-600 shrink-0"}),e.jsx("p",{className:"text-xs text-blue-800 leading-relaxed font-bold",children:"Your payment details are encrypted and never stored on our servers. You're protected by enterprise-grade security."})]})]})}),e.jsxs("div",{className:"lg:col-span-7 space-y-8 order-1 lg:order-2",children:[e.jsxs("div",{className:"flex flex-col gap-2 mb-4 px-4",children:[e.jsx("h1",{className:"text-4xl font-black text-gray-900 tracking-tighter uppercase",children:"Finalize Payment"}),e.jsx("p",{className:"text-gray-500 font-bold uppercase tracking-widest text-xs",children:"Step 2 of 2: Secure Checkout"})]}),e.jsxs("div",{className:"space-y-4",children:[d.map(s=>e.jsx("button",{onClick:()=>b(s.id),className:`w-full group relative transition-all duration-300 ${a===s.id?"scale-[1.02]":"hover:scale-[1.01]"}`,children:e.jsxs("div",{className:`p-6 rounded-[2rem] border-2 flex items-center transition-all ${a===s.id?"bg-white border-purple-600 shadow-2xl shadow-purple-900/10":"bg-white/50 border-gray-100 hover:border-purple-200"}`,children:[e.jsxs("div",{className:`w-14 h-14 rounded-2xl flex items-center justify-center transition-colors ${a===s.id?"bg-purple-600 text-white":"bg-gray-100 text-gray-400 group-hover:bg-purple-50"}`,children:[s.gateway_type==="paynow"&&e.jsx(A,{className:"w-7 h-7"}),s.gateway_type==="paypal"&&e.jsx(I,{className:"w-7 h-7"}),s.gateway_type==="stripe"&&e.jsx(T,{className:"w-7 h-7"}),!["paynow","paypal","stripe"].includes(s.gateway_type)&&e.jsx(z,{className:"w-7 h-7"})]}),e.jsxs("div",{className:"ml-6 text-left flex-1",children:[e.jsx("h4",{className:"text-lg font-black text-gray-900 uppercase tracking-tight",children:s.display_name}),e.jsx("p",{className:"text-xs text-gray-500 font-bold tracking-wide mt-0.5",children:s.description})]}),e.jsx("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all ${a===s.id?"border-purple-600 bg-purple-600":"border-gray-200"}`,children:a===s.id&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-white animate-in zoom-in"})})]})},s.id)),d.length===0&&e.jsxs("div",{className:"p-12 text-center bg-white rounded-[2rem] border-2 border-dashed border-gray-200",children:[e.jsx(E,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 font-bold uppercase tracking-widest text-xs",children:"No active payment methods found"})]})]}),e.jsxs("button",{disabled:h||!a,onClick:S,className:"w-full mt-10 relative group overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-purple-700 to-indigo-700 group-hover:scale-105 transition-transform duration-500"}),e.jsx("div",{className:"relative py-6 rounded-[2rem] flex items-center justify-center gap-4 text-white font-black uppercase tracking-widest shadow-2xl shadow-purple-900/30 active:scale-[0.98] transition-all disabled:opacity-50",children:h?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"w-6 h-6 animate-spin"}),"Processing Securely..."]}):e.jsxs(e.Fragment,{children:["Complete Payment ",e.jsx(L,{className:"w-6 h-6 group-hover:translate-x-1 transition-transform"})]})})]}),e.jsx("p",{className:"text-center text-[10px] font-black text-gray-400 uppercase tracking-[0.3em] mt-8",children:"Verified Secure by Zimaio Trust"})]})]})})}export{U as VendorPayment};
