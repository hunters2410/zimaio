import{s as o}from"./index-DO0RgZ49.js";let r=o;const c={setSupabase(e){r=e},async getActiveGateways(){const{data:e,error:t}=await r.from("payment_gateways").select("*").eq("is_active",!0).order("sort_order",{ascending:!0});if(t)throw t;return e||[]},async getAllGateways(){const{data:e,error:t}=await r.from("payment_gateways").select("*").order("sort_order",{ascending:!0});if(t)throw t;return e||[]},async getGatewayById(e){const{data:t,error:a}=await r.from("payment_gateways").select("*").eq("id",e).maybeSingle();if(a)throw a;return t},async updateGateway(e,t){const{data:a,error:n}=await r.from("payment_gateways").update(t).eq("id",e).select();if(n)throw n;if(!a||a.length===0)throw new Error("Update failed: Record not found or permission denied. Check if you have administrator roles assigned.")},async createManualGateway(e){const{data:t,error:a}=await r.from("payment_gateways").insert({gateway_name:e.gateway_name,gateway_type:"manual",display_name:e.display_name,description:e.description,is_active:e.is_active,is_default:!1,configuration:e.configuration||{},supported_currencies:e.supported_currencies,instructions:e.instructions,logo_url:e.logo_url,sort_order:e.sort_order}).select().single();if(a)throw a;return t},async deleteGateway(e){const{error:t}=await r.from("payment_gateways").delete().eq("id",e);if(t)throw t},async getInstructions(e){const{data:t,error:a}=await r.from("payment_instructions").select("*").eq("gateway_id",e).order("step_number",{ascending:!0});if(a)throw a;return t||[]},async saveInstructions(e,t){if(await r.from("payment_instructions").delete().eq("gateway_id",e),t.length>0){const{error:a}=await r.from("payment_instructions").insert(t.map(n=>({gateway_id:e,step_number:n.step_number,title:n.title,description:n.description})));if(a)throw a}},async createTransaction(e){const{data:t,error:a}=await r.from("payment_transactions").insert(e).select().single();if(a)throw a;return t},async updateTransaction(e,t){const{data:a,error:n}=await r.from("payment_transactions").update(t).eq("id",e).select();if(n)throw n;if(!a||a.length===0)throw new Error("Update failed: Transaction not found or permission denied.")},async getTransactionById(e){const{data:t,error:a}=await r.from("payment_transactions").select("*").eq("id",e).maybeSingle();if(a)throw a;return t},async getUserTransactions(e){const{data:t,error:a}=await r.from("payment_transactions").select("*").eq("user_id",e).order("created_at",{ascending:!1});if(a)throw a;return t||[]},async getAllTransactions(){const{data:e,error:t}=await r.from("payment_transactions").select("*").order("created_at",{ascending:!1});if(t)throw t;return e||[]},async initiatePayment(e){const t=`${r.supabaseUrl}/functions/v1/process-payment`,a=r.supabaseKey,n=await fetch(t,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok){const s=await n.json();throw new Error(s.error||"Payment initiation failed")}return await n.json()}};export{c as p};
