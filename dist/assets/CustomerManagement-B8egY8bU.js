import{v as G,r as d,s as u,j as e,n as U,S as B,M as W,g as K,z as ee}from"./index-BktnpWS0.js";import{A as F}from"./AdminLayout-C6Mn2_Yu.js";import{P as te}from"./plus-DKkFzrwN.js";import{X as D}from"./x-Be8cuiWM.js";import{C as se}from"./calendar-CBE4Rgbp.js";import{E as ae}from"./eye-geM34do8.js";import{S as re}from"./square-pen-RrpnH1Wm.js";import{U as le}from"./user-x-BeFz5KZK.js";import{U as ne}from"./user-check-DmjDKnBZ.js";import{T as ie}from"./trash-2-BZYqHlTV.js";import"./chevron-left-AWoZAuKB.js";import"./triangle-alert-HMuOKNOn.js";import"./circle-check-big-DQYFJHkd.js";import"./chevron-right-peYPGYwP.js";import"./zap-CpGj1Zaf.js";import"./maximize-DSH1SQuK.js";import"./store-DDL7ZG_8.js";import"./users-vNuzB1jC.js";import"./shield-QBrICIHj.js";import"./file-text-DIHdwLby.js";import"./globe-CdXxteOx.js";import"./truck-CO3939ut.js";import"./credit-card-BMxorgaG.js";import"./settings-D3GsvmJN.js";import"./trending-up-wuknMfwd.js";function Le(){const{theme:q}=G(),l=q==="dark",[I,P]=d.useState([]),[$,h]=d.useState(!0),[v,T]=d.useState(""),[p,C]=d.useState("all"),[w,J]=d.useState(""),[N,O]=d.useState(""),[V,k]=d.useState(!1),[z,A]=d.useState(!1),[i,S]=d.useState(null),[b,E]=d.useState(!1),[f,m]=d.useState(null),[s,g]=d.useState({email:"",password:"",full_name:"",phone:"",currency_code:"USD",language_code:"en",is_active:!0});d.useEffect(()=>{y()},[p,w,N]);const y=async()=>{h(!0);let t=u.from("profiles").select("*").eq("role","customer").order("created_at",{ascending:!1});if(p!=="all"&&(t=t.eq("is_active",p==="active")),w&&(t=t.gte("created_at",new Date(w).toISOString())),N){const c=new Date(N);c.setHours(23,59,59,999),t=t.lte("created_at",c.toISOString())}const{data:r,error:n}=await t;n?m({type:"error",text:n.message}):P(r||[]),h(!1)},Z=async(t,r)=>{try{const{error:n}=await u.from("profiles").update({is_active:!r}).eq("id",t);if(n)throw n;m({type:"success",text:`Customer ${r?"deactivated":"activated"} successfully`}),y()}catch(n){m({type:"error",text:n.message})}},H=async t=>{t.preventDefault(),h(!0);try{const r=ee("https://mnkncdqalkamhmtfcykm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1ua25jZHFhbGthbWhtdGZjeWttIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg4MjQ1OTAsImV4cCI6MjA4NDQwMDU5MH0.9Hxdgh_-wQImFfq3Tb8OHPkSN2oRjR_AzMAY1jn1ZQk",{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}}),{data:n,error:c}=await r.auth.signUp({email:s.email,password:s.password});if(c)throw c;if(!n.user)throw new Error("Failed to create user");const{error:M}=await u.rpc("create_customer_profile_secure",{p_id:n.user.id,p_email:s.email,p_full_name:s.full_name,p_phone:s.phone||null,p_currency_code:s.currency_code,p_language_code:s.language_code,p_is_active:s.is_active});if(M)throw M;m({type:"success",text:"Customer "+s.full_name+" created successfully"}),j(),y()}catch(r){m({type:"error",text:r.message||"Failed to create customer"})}finally{h(!1)}},Q=async t=>{if(t.preventDefault(),!!i){h(!0);try{const r={full_name:s.full_name,phone:s.phone,currency_code:s.currency_code,language_code:s.language_code,is_active:s.is_active};if(s.email!==i.email){const{error:c}=await u.auth.updateUser({email:s.email});if(c)throw c;r.email=s.email}if(s.password){const{error:c}=await u.auth.updateUser({password:s.password});if(c)throw c}const{error:n}=await u.from("profiles").update(r).eq("id",i.id);if(n)throw n;m({type:"success",text:"Customer "+s.full_name+" updated successfully"}),j(),y()}catch(r){m({type:"error",text:r.message||"Failed to update customer"})}finally{h(!1)}}},R=async t=>{if(confirm("Are you sure you want to delete this customer? This action cannot be undone."))try{const{error:r}=await u.auth.admin.deleteUser(t);if(r)throw r;m({type:"success",text:"Customer deleted successfully"}),y()}catch(r){m({type:"error",text:r.message||"Failed to delete customer"})}},X=t=>{S(t),E(!0),g({email:t.email,password:"",full_name:t.full_name||"",phone:t.phone||"",currency_code:t.currency_code||"USD",language_code:t.language_code||"en",is_active:t.is_active}),k(!0)},Y=t=>{S(t),A(!0)},j=()=>{k(!1),A(!1),S(null),E(!1),g({email:"",password:"",full_name:"",phone:"",currency_code:"USD",language_code:"en",is_active:!0})},L=I.filter(t=>{var r,n,c;return((r=t.email)==null?void 0:r.toLowerCase().includes(v.toLowerCase()))||((n=t.full_name)==null?void 0:n.toLowerCase().includes(v.toLowerCase()))||((c=t.phone)==null?void 0:c.toLowerCase().includes(v.toLowerCase()))}),_=l?"bg-gray-800":"bg-white",o=l?"text-gray-100":"text-gray-900",a=l?"text-gray-400":"text-gray-600",x=l?"border-gray-700":"border-gray-200";return $&&I.length===0?e.jsx(F,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})})}):e.jsxs(F,{children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:`text-3xl font-bold ${o}`,children:"Customer Management"}),e.jsx("p",{className:a,children:"Manage and monitor customer accounts"})]}),e.jsxs("button",{onClick:()=>k(!0),className:"flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-cyan-600 to-green-600 text-white rounded-lg hover:from-cyan-700 hover:to-green-700 transition",children:[e.jsx(te,{className:"h-5 w-5"}),e.jsx("span",{children:"Add Customer"})]})]})}),f&&e.jsxs("div",{className:`mb-6 p-4 rounded-lg flex items-start space-x-3 ${f.type==="success"?"bg-green-50 border border-green-200 text-green-800":"bg-red-50 border border-red-200 text-red-800"}`,children:[e.jsx(U,{className:"h-5 w-5 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:f.text}),e.jsx("button",{onClick:()=>m(null),className:"ml-auto",children:e.jsx(D,{className:"h-4 w-4"})})]}),e.jsx("div",{className:`${_} rounded-lg shadow-sm p-6 mb-6`,children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(B,{className:`absolute left-3 top-1/2 transform -translate-y-1/2 ${a} h-5 w-5`}),e.jsx("input",{type:"text",placeholder:"Search by name, email or phone...",value:v,onChange:t=>T(t.target.value),className:`w-full pl-10 pr-4 py-2 border ${x} rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 ${l?"bg-gray-700 text-gray-100":"bg-white"}`})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("input",{type:"date",value:w,onChange:t=>J(t.target.value),className:`px-3 py-2 border ${x} rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 ${l?"bg-gray-700 text-gray-100":"bg-white"}`,placeholder:"Start Date"}),e.jsx("input",{type:"date",value:N,onChange:t=>O(t.target.value),className:`px-3 py-2 border ${x} rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 ${l?"bg-gray-700 text-gray-100":"bg-white"}`,placeholder:"End Date"}),e.jsx("button",{onClick:()=>C("all"),className:`px-4 py-2 rounded-lg transition ${p==="all"?"bg-gradient-to-r from-cyan-600 to-green-600 text-white":`${l?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`}`,children:"All"}),e.jsx("button",{onClick:()=>C("active"),className:`px-4 py-2 rounded-lg transition ${p==="active"?"bg-gradient-to-r from-cyan-600 to-green-600 text-white":`${l?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`}`,children:"Active"}),e.jsx("button",{onClick:()=>C("inactive"),className:`px-4 py-2 rounded-lg transition ${p==="inactive"?"bg-gradient-to-r from-cyan-600 to-green-600 text-white":`${l?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`}`,children:"Inactive"})]})]})}),e.jsxs("div",{className:`${_} rounded-lg shadow-sm overflow-hidden`,children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border-collapse border border-gray-200 dark:border-gray-700",children:[e.jsx("thead",{className:l?"bg-gray-700":"bg-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:`px-6 py-3 border border-gray-200 dark:border-gray-700 text-left text-xs font-medium ${a} uppercase tracking-wider`,children:"Customer"}),e.jsx("th",{className:`px-6 py-3 border border-gray-200 dark:border-gray-700 text-left text-xs font-medium ${a} uppercase tracking-wider`,children:"Contact"}),e.jsx("th",{className:`px-6 py-3 border border-gray-200 dark:border-gray-700 text-left text-xs font-medium ${a} uppercase tracking-wider`,children:"Status"}),e.jsx("th",{className:`px-6 py-3 border border-gray-200 dark:border-gray-700 text-left text-xs font-medium ${a} uppercase tracking-wider`,children:"Joined"}),e.jsx("th",{className:`px-6 py-3 border border-gray-200 dark:border-gray-700 text-left text-xs font-medium ${a} uppercase tracking-wider`,children:"Actions"})]})}),e.jsx("tbody",{className:`divide-y ${l?"divide-gray-700":"divide-gray-200"}`,children:L.map(t=>e.jsxs("tr",{className:l?"hover:bg-gray-700":"hover:bg-white",children:[e.jsx("td",{className:"px-6 py-4 border border-gray-200 dark:border-gray-700 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:`text-sm font-medium ${o}`,children:t.full_name||"N/A"}),e.jsx("div",{className:`text-sm ${a}`,children:t.email})]})}),e.jsx("td",{className:"px-6 py-4 border border-gray-200 dark:border-gray-700 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:`flex items-center text-sm ${a}`,children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),t.email]}),t.phone&&e.jsxs("div",{className:`flex items-center text-sm ${a}`,children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),t.phone]})]})}),e.jsxs("td",{className:"px-6 py-4 border border-gray-200 dark:border-gray-700 whitespace-nowrap",children:[e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${t.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.is_active?"Active":"Inactive"}),t.is_verified&&e.jsx("span",{className:"ml-2 px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800",children:"Verified"})]}),e.jsx("td",{className:"px-6 py-4 border border-gray-200 dark:border-gray-700 whitespace-nowrap",children:e.jsxs("div",{className:`flex items-center text-sm ${a}`,children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),new Date(t.created_at).toLocaleDateString()]})}),e.jsx("td",{className:"px-6 py-4 border border-gray-200 dark:border-gray-700 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>Y(t),className:"text-blue-600 hover:text-blue-900",title:"View Details",children:e.jsx(ae,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>X(t),className:"text-cyan-600 hover:text-cyan-900",title:"Edit",children:e.jsx(re,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>Z(t.id,t.is_active),className:t.is_active?"text-red-600 hover:text-red-900":"text-green-600 hover:text-green-900",title:t.is_active?"Deactivate":"Activate",children:t.is_active?e.jsx(le,{className:"h-5 w-5"}):e.jsx(ne,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>R(t.id),className:"text-red-600 hover:text-red-900",title:"Delete",children:e.jsx(ie,{className:"h-5 w-5"})})]})})]},t.id))})]})}),L.length===0&&e.jsx("div",{className:`text-center py-12 ${a}`,children:"No customers found matching your criteria."})]}),V&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:`${_} rounded-lg shadow-xl max-w-lg w-full max-h-[90vh] overflow-y-auto`,children:[e.jsxs("div",{className:`p-4 border-b ${x} flex items-center justify-between`,children:[e.jsx("h2",{className:`text-xl font-bold ${o}`,children:b?"Edit Customer":"Add Customer"}),e.jsx("button",{onClick:j,className:`${a} hover:text-gray-600 transition`,children:e.jsx(D,{className:"h-5 w-5"})})]}),f&&e.jsxs("div",{className:`mx-4 mt-4 p-3 rounded-lg flex items-start space-x-2 text-xs font-bold ${f.type==="success"?"bg-green-50 border border-green-200 text-green-800":"bg-red-50 border border-red-200 text-red-800"}`,children:[e.jsx(U,{className:"h-4 w-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:f.text})]}),e.jsxs("form",{onSubmit:b?Q:H,className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-[10px] font-black uppercase mb-1 ${a}`,children:"Email *"}),e.jsx("input",{type:"email",required:!0,value:s.email,onChange:t=>g({...s,email:t.target.value}),className:`w-full px-3 py-1.5 text-sm border ${x} rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500/20 ${l?"bg-gray-700 text-gray-100":"bg-white"}`})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`block text-[10px] font-black uppercase mb-1 ${a}`,children:["Password ",b?"(Optional)":"*"]}),e.jsx("input",{type:"password",required:!b,value:s.password,onChange:t=>g({...s,password:t.target.value}),className:`w-full px-3 py-1.5 text-sm border ${x} rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500/20 ${l?"bg-gray-700 text-gray-100":"bg-white"}`,minLength:6})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-[10px] font-black uppercase mb-1 ${a}`,children:"Full Name *"}),e.jsx("input",{type:"text",required:!0,value:s.full_name,onChange:t=>g({...s,full_name:t.target.value}),className:`w-full px-3 py-1.5 text-sm border ${x} rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500/20 ${l?"bg-gray-700 text-gray-100":"bg-white"}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-[10px] font-black uppercase mb-1 ${a}`,children:"Phone"}),e.jsx("input",{type:"tel",value:s.phone,onChange:t=>g({...s,phone:t.target.value}),className:`w-full px-3 py-1.5 text-sm border ${x} rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500/20 ${l?"bg-gray-700 text-gray-100":"bg-white"}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-[10px] font-black uppercase mb-1 ${a}`,children:"Language"}),e.jsxs("select",{value:s.language_code,onChange:t=>g({...s,language_code:t.target.value}),className:`w-full px-3 py-1.5 text-sm border ${x} rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500/20 ${l?"bg-gray-700 text-gray-100":"bg-white"}`,children:[e.jsx("option",{value:"en",children:"English"}),e.jsx("option",{value:"es",children:"Spanish"}),e.jsx("option",{value:"fr",children:"French"})]})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.is_active,onChange:t=>g({...s,is_active:t.target.checked}),className:"rounded text-cyan-600 focus:ring-cyan-500"}),e.jsx("span",{className:`text-sm ${o}`,children:"Active Account"})]})}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{type:"button",onClick:j,className:`px-3 py-1.5 text-sm font-bold border ${x} rounded-lg hover:bg-gray-100 transition ${l?"text-gray-300 hover:bg-gray-700":"text-gray-700"}`,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:$,className:"px-3 py-1.5 text-sm font-bold bg-gradient-to-r from-cyan-600 to-green-600 text-white rounded-lg hover:shadow-lg transition disabled:opacity-50",children:$?"Processing...":b?"Update":"Create"})]})]})]})}),z&&i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:`${_} rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto`,children:[e.jsxs("div",{className:`p-6 border-b ${x} flex items-center justify-between`,children:[e.jsx("h2",{className:`text-2xl font-bold ${o}`,children:"Customer Details"}),e.jsx("button",{onClick:j,className:`${a} hover:text-gray-600 transition`,children:e.jsx(D,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"p-6 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${a}`,children:"Full Name"}),e.jsx("p",{className:`text-lg font-medium ${o}`,children:i.full_name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${a}`,children:"Email"}),e.jsx("p",{className:`text-lg font-medium ${o}`,children:i.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${a}`,children:"Phone"}),e.jsx("p",{className:`text-lg font-medium ${o}`,children:i.phone||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${a}`,children:"Language"}),e.jsx("p",{className:`text-lg font-medium ${o}`,children:i.language_code})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${a}`,children:"Status"}),e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${i.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:i.is_active?"Active":"Inactive"})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${a}`,children:"2FA Enabled"}),e.jsx("p",{className:`text-lg font-medium ${o}`,children:i.two_factor_enabled?"Yes":"No"})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${a}`,children:"Verified"}),e.jsx("p",{className:`text-lg font-medium ${o}`,children:i.is_verified?"Yes":"No"})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${a}`,children:"Joined"}),e.jsx("p",{className:`text-lg font-medium ${o}`,children:new Date(i.created_at).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${a}`,children:"Last Login"}),e.jsx("p",{className:`text-lg font-medium ${o}`,children:i.last_login?new Date(i.last_login).toLocaleDateString():"Never"})]})]})})]})})]})}export{Le as CustomerManagement};
